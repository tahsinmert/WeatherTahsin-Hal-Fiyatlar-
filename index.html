<!DOCTYPE html>
<html lang="tr">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Ultra Detaylı Hal Fiyatları - Elma Piyasası</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        .gradient-bg {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
        }
        .card-hover {
            transition: all 0.3s ease;
        }
        .card-hover:hover {
            transform: translateY(-5px);
            box-shadow: 0 20px 25px -5px rgba(0, 0, 0, 0.1), 0 10px 10px -5px rgba(0, 0, 0, 0.04);
        }
        .price-trend-up {
            color: #10b981;
        }
        .price-trend-down {
            color: #ef4444;
        }
        .price-trend-stable {
            color: #6b7280;
        }
        .source-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
        }
        .source-ibb {
            background-color: #dbeafe;
            color: #1d4ed8;
        }
        .source-basakapp {
            background-color: #dcfce7;
            color: #166534;
        }
        .source-fallback {
            background-color: #fef3c7;
            color: #d97706;
        }
        .quality-badge {
            font-size: 0.75rem;
            padding: 0.25rem 0.5rem;
            border-radius: 0.375rem;
            font-weight: 500;
        }
        .quality-1 {
            background-color: #dcfce7;
            color: #166534;
        }
        .quality-2 {
            background-color: #fef3c7;
            color: #d97706;
        }
        .organic-badge {
            background-color: #f0fdf4;
            color: #15803d;
            border: 1px solid #22c55e;
        }
        
        /* Mobil optimizasyonları */
        .mobile-price-card {
            border-radius: 12px;
            box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1);
            transition: all 0.3s ease;
        }
        .mobile-price-card:active {
            transform: scale(0.98);
        }
        .mobile-price-large {
            font-size: 1.5rem;
            font-weight: 700;
            line-height: 1.2;
        }
        .mobile-price-small {
            font-size: 0.875rem;
            opacity: 0.8;
        }
        .mobile-trend-icon {
            font-size: 1rem;
            margin-right: 0.25rem;
        }
        .mobile-organic-indicator {
            position: absolute;
            top: 8px;
            right: 8px;
            width: 20px;
            height: 20px;
            border-radius: 50%;
            background: #22c55e;
            display: flex;
            align-items: center;
            justify-content: center;
            color: white;
            font-size: 0.75rem;
        }
        
        /* Mobil tablo gizleme */
        @media (max-width: 768px) {
            .desktop-table {
                display: none;
            }
            .mobile-cards {
                display: block;
            }
        }
        
        @media (min-width: 769px) {
            .mobile-cards {
                display: none;
            }
            .desktop-table {
                display: table;
            }
        }
    </style>
</head>
<body class="bg-gray-50">
    <!-- Header -->
    <header class="gradient-bg text-white shadow-lg">
        <div class="container mx-auto px-4 py-4 md:py-6">
            <div class="flex items-center justify-between">
                <div class="flex items-center space-x-3 md:space-x-4">
                    <i class="fas fa-apple-alt text-2xl md:text-4xl"></i>
                    <div>
                        <h1 class="text-xl md:text-3xl font-bold">WeatherTahsin Hal Fiyatları</h1>
                        <p class="text-xs md:text-sm text-blue-100">Çoklu Kaynak - Elma Piyasası Takip Sistemi v2.0</p>
                    </div>
                </div>
                <div class="text-right">
                    <div class="flex items-center space-x-3 mb-2">
                        <button onclick="handleRefreshClick()" class="bg-white bg-opacity-20 hover:bg-opacity-30 text-white px-3 py-1 rounded-lg text-xs md:text-sm transition-all duration-200 flex items-center space-x-1">
                            <i class="fas fa-sync-alt"></i>
                            <span>Yenile</span>
                        </button>
                    </div>
                    <p class="text-xs md:text-sm">Son Güncelleme</p>
                    <p id="lastUpdate" class="text-sm md:text-base font-semibold">Yükleniyor...</p>
                    <div class="mt-2">
                        <a href="https://weathertahsin.netlify.app" target="_blank" class="text-xs text-blue-200 hover:text-white underline">
                            <i class="fas fa-cloud-sun mr-1"></i>WeatherTahsin
                        </a>
                    </div>
                </div>
            </div>
        </div>
    </header>

    <!-- Main Content -->
    <main class="container mx-auto px-4 py-4 md:py-8">
        <!-- Info Banner -->
        <div class="bg-blue-50 border-l-4 border-blue-400 p-3 md:p-4 mb-6 md:mb-8">
            <div class="flex">
                <div class="flex-shrink-0">
                    <i class="fas fa-info-circle text-blue-400"></i>
                </div>
                <div class="ml-3">
                    <p class="text-xs md:text-sm text-blue-700">
                        <strong>Ultra Detaylı Sistem:</strong> 
                        <a href="https://tarim.ibb.istanbul/avrupa-yakasi-hal-mudurlugu/hal-fiyatlari.html" target="_blank" class="underline">İBB</a> | 
                        <a href="https://basakapp.com/hal-borsa-fiyatlari" target="_blank" class="underline">Başak App</a> |
                        <a href="https://borsa.tobb.org.tr/" target="_blank" class="underline">TOBB</a> |
                        <a href="https://www.tmo.gov.tr/" target="_blank" class="underline">TMO</a>
                    </p>
                </div>
            </div>
        </div>

        <!-- Stats Cards -->
        <div class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-6 mb-6 md:mb-8">
            <div class="bg-white rounded-lg shadow-md p-4 md:p-6 border-l-4 border-green-500 card-hover">
                <div class="flex items-center">
                    <div class="p-2 md:p-3 rounded-full bg-green-100 text-green-600">
                        <i class="fas fa-chart-line text-lg md:text-xl"></i>
                    </div>
                    <div class="ml-3 md:ml-4">
                        <p class="text-xs md:text-sm font-medium text-gray-600">Ortalama</p>
                        <p id="avgPrice" class="text-lg md:text-2xl font-bold text-gray-900">--</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-4 md:p-6 border-l-4 border-blue-500 card-hover">
                <div class="flex items-center">
                    <div class="p-2 md:p-3 rounded-full bg-blue-100 text-blue-600">
                        <i class="fas fa-seedling text-lg md:text-xl"></i>
                    </div>
                    <div class="ml-3 md:ml-4">
                        <p class="text-xs md:text-sm font-medium text-gray-600">Çeşit</p>
                        <p id="appleVarieties" class="text-lg md:text-2xl font-bold text-gray-900">--</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-4 md:p-6 border-l-4 border-yellow-500 card-hover">
                <div class="flex items-center">
                    <div class="p-2 md:p-3 rounded-full bg-yellow-100 text-yellow-600">
                        <i class="fas fa-database text-lg md:text-xl"></i>
                    </div>
                    <div class="ml-3 md:ml-4">
                        <p class="text-xs md:text-sm font-medium text-gray-600">Kalite</p>
                        <p id="dataQuality" class="text-sm md:text-lg font-bold text-gray-900">Ultra High</p>
                    </div>
                </div>
            </div>

            <div class="bg-white rounded-lg shadow-md p-4 md:p-6 border-l-4 border-purple-500 card-hover">
                <div class="flex items-center">
                    <div class="p-2 md:p-3 rounded-full bg-purple-100 text-purple-600">
                        <i class="fas fa-calendar-alt text-lg md:text-xl"></i>
                    </div>
                    <div class="ml-3 md:ml-4">
                        <p class="text-xs md:text-sm font-medium text-gray-600">Güncelleme</p>
                        <p id="updateDate" class="text-sm md:text-lg font-bold text-gray-900">--</p>
                    </div>
                </div>
            </div>
        </div>

        <!-- Price Chart -->
        <div class="bg-white rounded-lg shadow-md p-4 md:p-6 mb-6 md:mb-8">
            <h3 class="text-base md:text-lg font-semibold text-gray-800 mb-4">
                <i class="fas fa-chart-bar text-blue-600 mr-2"></i>
                Elma Çeşitleri Fiyat Grafiği
            </h3>
            <div class="h-60 md:h-80">
                <canvas id="priceChart"></canvas>
            </div>
        </div>

        <!-- Ultra Detaylı Elma Fiyatları - Mobil Kartlar -->
        <div class="bg-white rounded-lg shadow-md p-4 md:p-6">
            <h3 class="text-base md:text-lg font-semibold text-gray-800 mb-4">
                <i class="fas fa-apple-alt text-green-600 mr-2"></i>
                Ultra Detaylı Elma Fiyatları
            </h3>
            
            <!-- Mobil Kartlar -->
            <div class="mobile-cards grid grid-cols-1 gap-4" id="mobilePriceCards">
                <!-- Mobil kartlar buraya yüklenecek -->
            </div>
            
            <!-- Desktop Tablo -->
            <div class="desktop-table overflow-x-auto">
                <table class="min-w-full table-auto">
                    <thead class="bg-gray-50">
                        <tr>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Elma Çeşidi</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Min Fiyat</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Ortalama</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Max Fiyat</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Kalite</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Trend</th>
                            <th class="px-4 py-3 text-left text-xs font-medium text-gray-500 uppercase tracking-wider">Detaylar</th>
                        </tr>
                    </thead>
                    <tbody id="priceTableBody" class="bg-white divide-y divide-gray-200">
                        <!-- Desktop tablo verisi buraya yüklenecek -->
                    </tbody>
                </table>
            </div>
        </div>

        <!-- Advanced Analytics -->
        <div class="grid grid-cols-1 lg:grid-cols-2 gap-6 md:gap-8 mt-6 md:mt-8">
            <!-- Price Analysis -->
            <div class="bg-white rounded-lg shadow-md p-4 md:p-6">
                <h3 class="text-base md:text-lg font-semibold text-gray-800 mb-4">
                    <i class="fas fa-analytics text-purple-600 mr-2"></i>
                    Gelişmiş Fiyat Analizi
                </h3>
                <div id="priceAnalysis" class="space-y-3 md:space-y-4">
                    <!-- Analysis will be loaded here -->
                </div>
            </div>

            <!-- Market Intelligence -->
            <div class="bg-white rounded-lg shadow-md p-4 md:p-6">
                <h3 class="text-base md:text-lg font-semibold text-gray-800 mb-4">
                    <i class="fas fa-brain text-blue-600 mr-2"></i>
                    Piyasa İstihbaratı
                </h3>
                <div id="marketIntelligence" class="space-y-3 md:space-y-4">
                    <!-- Market intelligence will be loaded here -->
                </div>
            </div>
        </div>

        <!-- Quality Metrics -->
        <div class="bg-white rounded-lg shadow-md p-4 md:p-6 mt-6 md:mt-8">
            <h3 class="text-base md:text-lg font-semibold text-gray-800 mb-4">
                <i class="fas fa-shield-alt text-green-600 mr-2"></i>
                Veri Kalitesi Metrikleri
            </h3>
            <div id="qualityMetrics" class="grid grid-cols-2 md:grid-cols-4 gap-3 md:gap-4">
                <!-- Quality metrics will be loaded here -->
            </div>
        </div>
    </main>

    <!-- Footer -->
    <footer class="bg-gray-800 text-white py-6 md:py-8 mt-8 md:mt-12">
        <div class="container mx-auto px-4">
            <div class="text-center">
                <p class="text-xs md:text-sm text-gray-400">
                    © 2025 Ultra Detaylı Hal Fiyatları Takip Sistemi v2.0 | 
                    <a href="https://tarim.ibb.istanbul/avrupa-yakasi-hal-mudurlugu/hal-fiyatlari.html" target="_blank" class="text-blue-400 hover:text-blue-300">
                        İBB
                    </a> | 
                    <a href="https://basakapp.com/hal-borsa-fiyatlari" target="_blank" class="text-green-400 hover:text-green-300">
                        Başak App
                    </a> |
                    <a href="https://borsa.tobb.org.tr/" target="_blank" class="text-yellow-400 hover:text-yellow-300">
                        TOBB
                    </a> |
                    <a href="https://www.tmo.gov.tr/" target="_blank" class="text-red-400 hover:text-red-300">
                        TMO
                    </a> |
                    <a href="https://weathertahsin.netlify.app" target="_blank" class="text-cyan-400 hover:text-cyan-300">
                        <i class="fas fa-cloud-sun mr-1"></i>WeatherTahsin
                    </a>
                </p>
                <p class="text-xs text-gray-500 mt-2">
                    <i class="fas fa-code mr-1"></i>Tahsin Mert Mutlu tarafından kodlanmıştır
                </p>
            </div>
        </div>
    </footer>

    <script>
        // Load ultra detailed data
        async function loadUltraDetailedData() {
            try {
                // Show loading state
                document.getElementById('lastUpdate').textContent = 'Güncelleniyor...';
                
                const response = await fetch('/.netlify/functions/api/ultra_detayli_elma_fiyatlari?t=' + new Date().getTime());
                const data = await response.json();
                
                // Update header info
                document.getElementById('lastUpdate').textContent = data.metadata.data_collection_time;
                document.getElementById('updateDate').textContent = data.metadata.data_collection_time.split(' ')[0];
                document.getElementById('dataQuality').textContent = data.metadata.data_quality_level;
                
                // Update stats
                const prices = data.aggregated_data.map(item => item.avg_price);
                const avgPrice = (prices.reduce((a, b) => a + b, 0) / prices.length).toFixed(1);
                document.getElementById('avgPrice').textContent = avgPrice + ' TL/kg';
                document.getElementById('appleVarieties').textContent = data.aggregated_data.length;
                
                // Populate mobile price cards
                createMobilePriceCards(data.aggregated_data);
                
                // Populate desktop price table
                createDesktopPriceTable(data.aggregated_data);
                
                // Create price chart
                createUltraPriceChart(data.aggregated_data);
                
                // Create price analysis
                createUltraPriceAnalysis(data);
                
                // Create market intelligence
                createMarketIntelligence(data);
                
                // Create quality metrics
                createQualityMetrics(data);
                
                // Show success message
                showNotification('Veriler başarıyla güncellendi!', 'success');
                
            } catch (error) {
                console.error('Veri yükleme hatası:', error);
                document.getElementById('mobilePriceCards').innerHTML = `
                    <div class="text-center py-8 text-gray-500">
                        <i class="fas fa-exclamation-triangle text-yellow-500 text-2xl mb-2"></i>
                        <p>Veri yüklenirken hata oluştu. Lütfen sayfayı yenileyin.</p>
                    </div>
                `;
                showNotification('Veri güncellenirken hata oluştu!', 'error');
            }
        }
        
        // Manual refresh function
        async function refreshData() {
            try {
                // Show loading state
                showNotification('Veriler güncelleniyor...', 'info');
                
                // Call refresh API
                const refreshResponse = await fetch('/.netlify/functions/api/refresh');
                const refreshResult = await refreshResponse.json();
                
                if (refreshResult.success) {
                    // Reload data after refresh
                    await loadUltraDetailedData();
                } else {
                    showNotification('Veri yenileme başarısız!', 'error');
                }
            } catch (error) {
                console.error('Yenileme hatası:', error);
                showNotification('Yenileme sırasında hata oluştu!', 'error');
            }
        }
        
        // Notification function
        function showNotification(message, type = 'info') {
            // Remove existing notification
            const existingNotification = document.getElementById('notification');
            if (existingNotification) {
                existingNotification.remove();
            }
            
            // Create notification element
            const notification = document.createElement('div');
            notification.id = 'notification';
            notification.className = `fixed top-4 right-4 z-50 p-4 rounded-lg shadow-lg max-w-sm transform transition-all duration-300 translate-x-full`;
            
            // Set colors based on type
            let bgColor, textColor, icon;
            switch(type) {
                case 'success':
                    bgColor = 'bg-green-500';
                    textColor = 'text-white';
                    icon = 'fas fa-check-circle';
                    break;
                case 'error':
                    bgColor = 'bg-red-500';
                    textColor = 'text-white';
                    icon = 'fas fa-exclamation-circle';
                    break;
                case 'info':
                default:
                    bgColor = 'bg-blue-500';
                    textColor = 'text-white';
                    icon = 'fas fa-info-circle';
                    break;
            }
            
            notification.className += ` ${bgColor} ${textColor}`;
            
            notification.innerHTML = `
                <div class="flex items-center">
                    <i class="${icon} mr-2"></i>
                    <span>${message}</span>
                    <button onclick="this.parentElement.parentElement.remove()" class="ml-4 text-white hover:text-gray-200">
                        <i class="fas fa-times"></i>
                    </button>
                </div>
            `;
            
            document.body.appendChild(notification);
            
            // Animate in
            setTimeout(() => {
                notification.classList.remove('translate-x-full');
            }, 100);
            
            // Auto remove after 3 seconds
            setTimeout(() => {
                if (notification.parentElement) {
                    notification.classList.add('translate-x-full');
                    setTimeout(() => {
                        if (notification.parentElement) {
                            notification.remove();
                        }
                    }, 300);
                }
            }, 3000);
        }
        
        // Refresh button click handler
        function handleRefreshClick() {
            refreshData();
        }
        
        // Load data when page loads
        document.addEventListener('DOMContentLoaded', loadUltraDetailedData);
        
        // Refresh data when page becomes visible (user returns to tab)
        document.addEventListener('visibilitychange', function() {
            if (!document.hidden) {
                loadUltraDetailedData();
            }
        });
        
        // Refresh data when user focuses on the window
        window.addEventListener('focus', loadUltraDetailedData);
        
        // Auto-refresh every 5 minutes
        setInterval(loadUltraDetailedData, 5 * 60 * 1000);
        
        function createMobilePriceCards(data) {
            const cardsContainer = document.getElementById('mobilePriceCards');
            cardsContainer.innerHTML = '';
            
            data.forEach(item => {
                const trend = item.price_trend;
                const trendIcon = getTrendIcon(trend);
                const trendColor = getTrendColor(trend);
                const qualityClass = item.quality.includes('1') ? 'quality-1' : 'quality-2';
                
                const card = document.createElement('div');
                card.className = 'mobile-price-card bg-white border border-gray-200 p-4 relative';
                
                // Organik göstergesi
                const organicIndicator = item.organic_status ? 
                    '<div class="mobile-organic-indicator"><i class="fas fa-leaf"></i></div>' : '';
                
                card.innerHTML = `
                    ${organicIndicator}
                    <div class="flex items-center justify-between mb-3">
                        <div class="flex items-center space-x-2">
                            <i class="fas fa-apple-alt text-red-500"></i>
                            <h4 class="font-semibold text-gray-900 text-sm">${item.name}</h4>
                        </div>
                        <span class="quality-badge ${qualityClass} text-xs">${item.quality}</span>
                    </div>
                    
                    <div class="space-y-2">
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600 text-xs">Min:</span>
                            <span class="font-medium text-gray-900">${item.min_price} TL/kg</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600 text-xs">Ortalama:</span>
                            <span class="mobile-price-large text-blue-600">${item.avg_price} TL/kg</span>
                        </div>
                        <div class="flex justify-between items-center">
                            <span class="text-gray-600 text-xs">Max:</span>
                            <span class="font-medium text-gray-900">${item.max_price} TL/kg</span>
                        </div>
                    </div>
                    
                    <div class="flex justify-between items-center mt-3 pt-3 border-t border-gray-100">
                        <div class="flex items-center">
                            <span class="${trendColor}">
                                <i class="${trendIcon} mobile-trend-icon"></i>
                                <span class="text-xs">${trend}</span>
                            </span>
                        </div>
                        <div class="text-right">
                            <span class="text-xs text-gray-500">Volatilite</span>
                            <div class="text-xs font-medium text-gray-900">${item.price_volatility.toFixed(1)}%</div>
                        </div>
                    </div>
                    
                    ${item.organic_status ? '<div class="mt-2 text-xs text-green-600 font-medium">🌱 Organik Ürün</div>' : ''}
                `;
                
                cardsContainer.appendChild(card);
            });
        }
        
        function createDesktopPriceTable(data) {
            const tableBody = document.getElementById('priceTableBody');
            tableBody.innerHTML = '';
            
            data.forEach(item => {
                const row = document.createElement('tr');
                row.className = 'hover:bg-gray-50';
                
                const trend = item.price_trend;
                const trendIcon = getTrendIcon(trend);
                const trendColor = getTrendColor(trend);
                
                // Quality badge
                const qualityClass = item.quality.includes('1') ? 'quality-1' : 'quality-2';
                
                // Organic badge
                const organicBadge = item.organic_status ? '<span class="organic-badge ml-2">Organik</span>' : '';
                
                row.innerHTML = `
                    <td class="px-4 py-3 whitespace-nowrap">
                        <div class="flex items-center">
                            <i class="fas fa-apple-alt text-red-500 mr-2"></i>
                            <span class="font-medium text-gray-900">${item.name}</span>
                            ${organicBadge}
                        </div>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${item.min_price} TL/kg</td>
                    <td class="px-4 py-3 whitespace-nowrap">
                        <span class="font-semibold text-lg text-blue-600">${item.avg_price} TL/kg</span>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap text-sm text-gray-900">${item.max_price} TL/kg</td>
                    <td class="px-4 py-3 whitespace-nowrap">
                        <span class="quality-badge ${qualityClass}">${item.quality}</span>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap">
                        <span class="${trendColor}">
                            <i class="${trendIcon} mr-1"></i>
                            ${trend}
                        </span>
                    </td>
                    <td class="px-4 py-3 whitespace-nowrap">
                        <button onclick="showProductDetails('${item.name}')" class="text-blue-600 hover:text-blue-800">
                            <i class="fas fa-info-circle"></i> Detaylar
                        </button>
                    </td>
                `;
                tableBody.appendChild(row);
            });
        }
        
        function getTrendIcon(trend) {
            switch(trend) {
                case 'Yükseliş': return 'fas fa-arrow-up';
                case 'Düşüş': return 'fas fa-arrow-down';
                default: return 'fas fa-minus';
            }
        }
        
        function getTrendColor(trend) {
            switch(trend) {
                case 'Yükseliş': return 'price-trend-up';
                case 'Düşüş': return 'price-trend-down';
                default: return 'price-trend-stable';
            }
        }
        
        function createUltraPriceChart(data) {
            const ctx = document.getElementById('priceChart').getContext('2d');
            
            // Quality-based color coding
            const colors = data.map(item => {
                if (item.organic_status) return 'rgba(34, 197, 94, 0.8)'; // Green for organic
                if (item.quality.includes('1')) return 'rgba(59, 130, 246, 0.8)'; // Blue for 1st class
                return 'rgba(245, 158, 11, 0.8)'; // Orange for 2nd class
            });
            
            new Chart(ctx, {
                type: 'bar',
                data: {
                    labels: data.map(item => item.name.replace('Elma (', '').replace(')', '')),
                    datasets: [{
                        label: 'Ortalama Fiyat (TL/kg)',
                        data: data.map(item => item.avg_price),
                        backgroundColor: colors,
                        borderColor: data.map(item => {
                            if (item.organic_status) return 'rgba(34, 197, 94, 1)';
                            if (item.quality.includes('1')) return 'rgba(59, 130, 246, 1)';
                            return 'rgba(245, 158, 11, 1)';
                        }),
                        borderWidth: 1
                    }]
                },
                options: {
                    responsive: true,
                    maintainAspectRatio: false,
                    scales: {
                        y: {
                            beginAtZero: true,
                            title: {
                                display: true,
                                text: 'Fiyat (TL/kg)'
                            }
                        }
                    },
                    plugins: {
                        legend: {
                            display: false
                        }
                    }
                }
            });
        }
        
        function createUltraPriceAnalysis(data) {
            const analysisDiv = document.getElementById('priceAnalysis');
            
            // Advanced statistics
            const stats = data.statistics.price_statistics;
            const qualityDist = data.statistics.quality_distribution;
            const trends = data.statistics.price_trends;
            const volatility = data.statistics.volatility_analysis;
            
            analysisDiv.innerHTML = `
                <div class="p-3 md:p-4 bg-green-50 rounded-lg border border-green-200">
                    <div class="flex items-center">
                        <i class="fas fa-crown text-yellow-500 mr-2"></i>
                        <div>
                            <p class="text-xs md:text-sm font-medium text-green-800">En Yüksek Fiyatlı</p>
                            <p class="text-sm md:text-lg font-bold text-green-900">${data.aggregated_data[0].name}: ${data.aggregated_data[0].avg_price} TL/kg</p>
                        </div>
                    </div>
                </div>
                
                <div class="p-3 md:p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <div class="flex items-center">
                        <i class="fas fa-chart-line text-blue-500 mr-2"></i>
                        <div>
                            <p class="text-xs md:text-sm font-medium text-blue-800">Fiyat İstatistikleri</p>
                            <p class="text-sm md:text-lg font-bold text-blue-900">Ort: ${stats.mean.toFixed(1)} | Medyan: ${stats.median.toFixed(1)}</p>
                        </div>
                    </div>
                </div>
                
                <div class="p-3 md:p-4 bg-purple-50 rounded-lg border border-purple-200">
                    <div class="flex items-center">
                        <i class="fas fa-chart-bar text-purple-500 mr-2"></i>
                        <div>
                            <p class="text-xs md:text-sm font-medium text-purple-800">Kalite Dağılımı</p>
                            <p class="text-sm md:text-lg font-bold text-purple-900">1. Sınıf: ${qualityDist['1. Sınıf']} | 2. Sınıf: ${qualityDist['2. Sınıf']}</p>
                        </div>
                    </div>
                </div>
                
                <div class="p-3 md:p-4 bg-orange-50 rounded-lg border border-orange-200">
                    <div class="flex items-center">
                        <i class="fas fa-chart-pie text-orange-500 mr-2"></i>
                        <div>
                            <p class="text-xs md:text-sm font-medium text-orange-800">Trend Analizi</p>
                            <p class="text-sm md:text-lg font-bold text-orange-900">Yükseliş: ${trends.Yükseliş} | Stabil: ${trends.Stabil} | Düşüş: ${trends.Düşüş}</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function createMarketIntelligence(data) {
            const intelligenceDiv = document.getElementById('marketIntelligence');
            
            const demandSupply = data.statistics.demand_supply_analysis;
            const volatility = data.statistics.volatility_analysis;
            
            intelligenceDiv.innerHTML = `
                <div class="p-3 md:p-4 bg-indigo-50 rounded-lg border border-indigo-200">
                    <div class="flex items-center">
                        <i class="fas fa-chart-area text-indigo-500 mr-2"></i>
                        <div>
                            <p class="text-xs md:text-sm font-medium text-indigo-800">Volatilite Analizi</p>
                            <p class="text-sm md:text-lg font-bold text-indigo-900">Ort: ${volatility.average_volatility.toFixed(1)}%</p>
                        </div>
                    </div>
                </div>
                
                <div class="p-3 md:p-4 bg-teal-50 rounded-lg border border-teal-200">
                    <div class="flex items-center">
                        <i class="fas fa-balance-scale text-teal-500 mr-2"></i>
                        <div>
                            <p class="text-xs md:text-sm font-medium text-teal-800">Arz-Talep Dengesi</p>
                            <p class="text-sm md:text-lg font-bold text-teal-900">Talep: ${Object.keys(demandSupply.demand).length} seviye</p>
                        </div>
                    </div>
                </div>
                
                <div class="p-3 md:p-4 bg-pink-50 rounded-lg border border-pink-200">
                    <div class="flex items-center">
                        <i class="fas fa-leaf text-pink-500 mr-2"></i>
                        <div>
                            <p class="text-xs md:text-sm font-medium text-pink-800">Organik Ürünler</p>
                            <p class="text-sm md:text-lg font-bold text-pink-900">${data.aggregated_data.filter(item => item.organic_status).length} çeşit</p>
                        </div>
                    </div>
                </div>
                
                <div class="p-3 md:p-4 bg-gray-50 rounded-lg border border-gray-200">
                    <div class="flex items-center">
                        <i class="fas fa-certificate text-gray-500 mr-2"></i>
                        <div>
                            <p class="text-xs md:text-sm font-medium text-gray-800">Sertifikasyon</p>
                            <p class="text-sm md:text-lg font-bold text-gray-900">GAP, GlobalGAP, Organik</p>
                        </div>
                    </div>
                </div>
            `;
        }
        
        function createQualityMetrics(data) {
            const metricsDiv = document.getElementById('qualityMetrics');
            
            const qualityMetrics = data.quality_metrics;
            
            metricsDiv.innerHTML = `
                <div class="p-3 md:p-4 bg-green-50 rounded-lg border border-green-200">
                    <div class="text-center">
                        <i class="fas fa-star text-green-500 text-xl md:text-2xl mb-2"></i>
                        <p class="text-xs md:text-sm font-medium text-green-800">Genel Kalite</p>
                        <p class="text-lg md:text-xl font-bold text-green-900">${qualityMetrics.overall_quality_score.toFixed(1)}/100</p>
                    </div>
                </div>
                
                <div class="p-3 md:p-4 bg-blue-50 rounded-lg border border-blue-200">
                    <div class="text-center">
                        <i class="fas fa-clock text-blue-500 text-xl md:text-2xl mb-2"></i>
                        <p class="text-xs md:text-sm font-medium text-blue-800">Veri Tazeliği</p>
                        <p class="text-lg md:text-xl font-bold text-blue-900">${qualityMetrics.data_freshness}/100</p>
                    </div>
                </div>
                
                <div class="p-3 md:p-4 bg-purple-50 rounded-lg border border-purple-200">
                    <div class="text-center">
                        <i class="fas fa-check-circle text-purple-500 text-xl md:text-2xl mb-2"></i>
                        <p class="text-xs md:text-sm font-medium text-purple-800">Doğruluk</p>
                        <p class="text-lg md:text-xl font-bold text-purple-900">${qualityMetrics.accuracy_score}/100</p>
                    </div>
                </div>
                
                <div class="p-3 md:p-4 bg-orange-50 rounded-lg border border-orange-200">
                    <div class="text-center">
                        <i class="fas fa-link text-orange-500 text-xl md:text-2xl mb-2"></i>
                        <p class="text-xs md:text-sm font-medium text-orange-800">Tutarlılık</p>
                        <p class="text-lg md:text-xl font-bold text-orange-900">${qualityMetrics.consistency_score}/100</p>
                    </div>
                </div>
            `;
        }
        
        function showProductDetails(productName) {
            // Bu fonksiyon ürün detaylarını gösterecek
            alert(`${productName} detayları yakında eklenecek!`);
        }
    </script>
</body>
</html>
